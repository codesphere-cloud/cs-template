version: "2.0"

# Codesphere CI configuration for Live Currency Exchange Rate Viewer
# This configures both the backend API and frontend Blazor services

# Backend API Service (ASP.NET Core Web API)
backend:
  buildCommand: |
    cd backend
    dotnet restore
    dotnet build --configuration Release
  
  startCommand: |
    cd backend
    dotnet run --configuration Release
  
  port: 3000
  
  # Environment variables for the backend
  environment:
    ASPNETCORE_ENVIRONMENT: Production
    ASPNETCORE_URLS: http://0.0.0.0:3000

# Frontend Service (Blazor Server)
frontend:
  buildCommand: |
    cd frontend
    dotnet restore
    dotnet build --configuration Release
  
  startCommand: |
    cd frontend
    dotnet run --configuration Release
  
  port: 5000
  
  # Environment variables for the frontend
  environment:
    ASPNETCORE_ENVIRONMENT: Production
    ASPNETCORE_URLS: http://0.0.0.0:5000

# Global configuration
global:
  # Install .NET 8 SDK
  prepare: |
    # Ensure .NET 8 SDK is available
    if ! command -v dotnet &> /dev/null; then
      wget https://dot.net/v1/dotnet-install.sh -O dotnet-install.sh
      chmod +x dotnet-install.sh
      ./dotnet-install.sh --version latest --install-dir ~/.dotnet
      export PATH="$HOME/.dotnet:$PATH"
    fi
    
    # Verify .NET installation
    dotnet --version
    
    # Restore solution dependencies
    dotnet restore CurrencyExchangeViewer.sln

# Health checks
healthcheck:
  backend:
    url: "http://localhost:3000/api/rate"
    timeout: 30s
    interval: 10s
    
  frontend:
    url: "http://localhost:5000"
    timeout: 30s
    interval: 10s
