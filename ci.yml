schemaVersion: v0.2
prepare:
  steps:
    - name: Install .NET 8 SDK and Build Projects
      command: |
        # Install .NET 8 SDK
        if ! command -v dotnet &> /dev/null; then
          wget https://dot.net/v1/dotnet-install.sh -O dotnet-install.sh
          chmod +x dotnet-install.sh
          ./dotnet-install.sh --version latest --install-dir ~/.dotnet
          export PATH="$HOME/.dotnet:$PATH"
          echo 'export PATH="$HOME/.dotnet:$PATH"' >> ~/.bashrc
        fi
        
        # Verify .NET installation
        export PATH="$HOME/.dotnet:$PATH"
        dotnet --version
        
        # Restore and build backend
        cd /home/user/app/backend
        dotnet restore
        dotnet build --configuration Release
        
        # Restore and build frontend
        cd /home/user/app/frontend
        dotnet restore
        dotnet build --configuration Release
test:
  steps: []
run:
  backend:
    steps:
      - name: Run Backend API
        command: |
          export PATH="$HOME/.dotnet:$PATH"
          cd /home/user/app/backend && dotnet run --configuration Release
    plan: 8
    replicas: 1
    isPublic: true
    network:
      path: /api
      stripPath: false
  frontend:
    steps:
      - name: Run Frontend App
        command: |
          export PATH="$HOME/.dotnet:$PATH"
          cd /home/user/app/frontend && dotnet run --configuration Release
    plan: 8
    replicas: 1
    isPublic: true
    network:
      path: /
      stripPath: false
